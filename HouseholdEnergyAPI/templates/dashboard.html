<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>‚ö° Energy Prediction Dashboard ‚ö°</title>
  <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0; padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Urbanist', sans-serif;
      background: linear-gradient(to right, #141e30, #243b55);
      color: #f0f0f0;
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: rgba(255,255,255,0.04);
      padding: 40px;
      border-radius: 20px;
      backdrop-filter: blur(12px);
      box-shadow: 0 12px 50px rgba(0,0,0,0.4);
      animation: fadeIn 0.6s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      text-align: center;
      color: #00ffc8;
      font-size: 2.2rem;
      margin-bottom: 1.5rem;
    }

    form {
      margin: 20px 0;
    }

    input[type="file"],
    button {
      display: block;
      width: 100%;
      padding: 14px 18px;
      margin-top: 15px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
    }

    input[type="file"] {
      background: #ffffff;
      color: #222;
      cursor: pointer;
    }

    button {
      background: #00b09b;
      color: white;
      font-weight: bold;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #00897b;
    }

    .result {
      background: rgba(0,0,0,0.3);
      padding: 25px;
      margin-top: 30px;
      border-radius: 12px;
    }

    .highlight {
      background-color: #1abc9c;
      padding: 12px 16px;
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
      border-radius: 10px;
      display: inline-block;
      margin-top: 10px;
    }

    pre {
      background-color: #111;
      color: #ccc;
      padding: 12px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.9rem;
    }

    img {
      display: block;
      width: 100%;
      max-width: 700px;
      margin: 20px auto 0;
      border-radius: 12px;
    }

    #overlay {
      position: fixed;
      display: none;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 9999;
    }

    #overlay .spinner {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 1.5rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="overlay">
    <div class="spinner">‚è≥ Please wait...</div>
  </div>

  <div class="container">
    <h2>‚ö° Household Energy Prediction</h2>

    <form action="/upload_csv" method="post" enctype="multipart/form-data">
      <label><strong>Upload CSV Dataset</strong></label>
      <input type="file" name="file" accept=".csv" required />
      <button type="submit">üìÅ Upload</button>
    </form>

    {% if csv_uploaded %}
      <form action="/train_model" method="post">
        <button type="submit">üöÄ Train Model</button>
      </form>
    {% endif %}

    {% if model_trained %}
      <form action="/predict" method="post">
        <button type="submit">üîç Predict</button>
      </form>
    {% endif %}

    {% if mse %}
    <div class="result">
      <h3>üìä Training Results</h3>
      <p><strong>MSE:</strong> <span class="highlight">{{ mse }}</span></p>
      <p><strong>R¬≤ Score:</strong> <span class="highlight">{{ r2 }}</span></p>
      {% if graph_url %}
        <img src="{{ graph_url }}" alt="Training Graph" />
      {% endif %}
    </div>
    {% endif %}

    {% if prediction %}
    <div class="result">
      <h3>üîÆ Prediction</h3>
      <p>Predicted Global Active Power:</p>
      <div class="highlight">{{ prediction }} kW</div>

      <h4>üì• Input Sample:</h4>
      <pre>{{ auto_input }}</pre>

      {% if graph_url %}
        <h4>üìä Comparison Graph</h4>
        <img src="{{ graph_url }}" alt="Prediction Graph" />
      {% endif %}
    </div>
    {% endif %}
  </div>

  {% if popup_message %}
  <script>
    alert("{{ popup_message }}");
  </script>
  {% endif %}
  
  {% if show_manual_form %}
<div class="result">
  <h3>‚úçÔ∏è Enter Values for Manual Prediction</h3>
  <form action="/manual_predict" method="post" style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
    
    <label><strong>Global Reactive Power:</strong></label>
    <input type="number" step="0.001" name="global_reactive_power" required placeholder="e.g. 0.104">
    
    <label><strong>Voltage:</strong></label>
    <input type="number" step="0.01" name="voltage" required placeholder="e.g. 241.52">

    <label><strong>Global Intensity:</strong></label>
    <input type="number" step="0.1" name="global_intensity" required placeholder="e.g. 10.4">

    <label><strong>Sub Metering 1:</strong></label>
    <input type="number" name="sub_metering_1" required placeholder="e.g. 1">

    <label><strong>Sub Metering 2:</strong></label>
    <input type="number" name="sub_metering_2" required placeholder="e.g. 1">

    <label><strong>Sub Metering 3:</strong></label>
    <input type="number" name="sub_metering_3" required placeholder="e.g. 1">

    <label><strong>Hour (0-23):</strong></label>
    <input type="number" name="hour" required min="0" max="23" placeholder="e.g. 15">

    <button type="submit">üîé Submit for Prediction</button>
  </form>
</div>
{% endif %}


  <script>
    document.querySelectorAll("form").forEach(form => {
      form.addEventListener("submit", () => {
        document.getElementById("overlay").style.display = "block";
      });
    });

    let logoutTimer;
    function resetTimer() {
      clearTimeout(logoutTimer);
      logoutTimer = setTimeout(() => {
        alert("You have been logged out due to inactivity.");
        window.location.href = "/";
      }, 2 * 60 * 1000); // 2 minutes
    }

    window.onload = resetTimer;
    document.onmousemove = resetTimer;
    document.onkeypress = resetTimer;
    document.onscroll = resetTimer;
  </script>
</body>
</html>
